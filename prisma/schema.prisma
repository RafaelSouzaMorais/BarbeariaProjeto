// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Cliente {
  id           String         @id @default(uuid())
  nome         String
  telefone     String
  observacoes  String?
  agendamentos Agendamento[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model Servico {
  id           String         @id @default(uuid())
  nome         String
  preco        Decimal        @db.Decimal(10,2)
  duracaoMin   Int
  ativo        Boolean        @default(true)
  agendamentos Agendamento[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model Usuario {
  id           String         @id @default(uuid())
  nome         String
  email        String         @unique
  senhaHash    String
  perfil       String         @default("Barbeiro") // "Admin" ou "Barbeiro"
  ativo        Boolean        @default(true)
  agendamentos Agendamento[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model Agendamento {
  id           String         @id @default(uuid())
  clienteId    String
  servicoId    String
  barbeiroId   String?
  dataHora     DateTime
  status       String         @default("Pendente") // Pendente, Confirmado, Concluido, Cancelado
  valor        Decimal        @db.Decimal(10,2)
  cliente      Cliente        @relation(fields: [clienteId], references: [id])
  servico      Servico        @relation(fields: [servicoId], references: [id])
  barbeiro     Usuario?       @relation(fields: [barbeiroId], references: [id])
  caixaLanc    CaixaLancamento?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model CaixaLancamento {
  id                 String           @id @default(uuid())
  dataHora           DateTime         @default(now())
  tipo               String           // "Entrada" ou "Saida"
  descricao          String
  valor              Decimal          @db.Decimal(10,2)
  agendamentoId      String?          @unique
  fechamentoCaixaId  String?
  agendamento        Agendamento?     @relation(fields: [agendamentoId], references: [id])
  fechamentoCaixa    FechamentoCaixa? @relation(fields: [fechamentoCaixaId], references: [id])
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
}

model FechamentoCaixa {
  id             String             @id @default(uuid())
  data           DateTime
  totalEntradas  Decimal            @db.Decimal(10,2)
  totalSaidas    Decimal            @db.Decimal(10,2)
  saldoFinal     Decimal            @db.Decimal(10,2)
  lancamentos    CaixaLancamento[]
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
}

model ConfiguracaoSistema {
  id                         String   @id @default(uuid())
  horaAbertura               String   // Ex: "08:00"
  horaFechamento             String   // Ex: "18:00"
  intervaloAtendimentoMinutos Int      @default(30)
  agendamentoAutomatico       Boolean  @default(true)
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
}
